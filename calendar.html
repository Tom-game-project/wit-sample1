<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Shift Viewer</title>
    <style>
        :root {
            --bg-color: #f4f6f8;
            --surface: #ffffff;
            --text-main: #333;
            --text-sub: #666;
            --border: #e0e0e0;
            --primary: #4a90e2;
            --header-bg: #4a90e2;
            --header-text: #fff;
            --day-bg: #f9f9f9;
        }
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            padding: 20px;
            margin: 0;
        }

        .container { max-width: 1400px; margin: 0 auto; }

        /* Controls */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: var(--surface);
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .month-label { font-size: 1.5rem; font-weight: bold; }
        .nav-btn {
            background: none; border: 1px solid var(--border);
            padding: 8px 16px; border-radius: 4px; cursor: pointer;
            font-size: 1rem; transition: background 0.2s;
        }
        .nav-btn:hover { background: #eee; }

        /* Calendar Grid */
        .calendar-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed; /* Equal width cells */
            background: var(--surface);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border-radius: 8px;
            overflow: hidden;
        }

        .calendar-table th {
            background: var(--header-bg);
            color: var(--header-text);
            padding: 10px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #357abd;
        }

        .calendar-table td {
            border: 1px solid var(--border);
            vertical-align: top;
            height: 120px; /* Min height */
            padding: 5px;
            background: #fff;
        }
        
        .calendar-table td.diff-month {
            background-color: #f4f4f4;
            color: #ccc;
        }

        /* Day Cell Content */
        .date-label {
            display: block;
            text-align: right;
            font-size: 0.9em;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-sub);
        }
        .today .date-label {
            color: var(--primary);
            text-decoration: underline;
        }

        .shift-section {
            margin-bottom: 4px;
            font-size: 0.8em;
        }
        .shift-label {
            font-size: 0.7em;
            text-transform: uppercase;
            color: #999;
            font-weight: bold;
            margin-bottom: 2px;
            border-bottom: 1px solid #eee;
        }

        /* Chips */
        .staff-chip {
            display: inline-block;
            font-size: 1.25em;
            padding: 2px 6px;
            margin: 1px;
            border-radius: 4px;
            background: #eee;
            color: #333;
            border-left: 4px solid #999; /* Group Color */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
            box-sizing: border-box;
            cursor: default;
        }
        .staff-chip:hover { opacity: 0.8; }

    </style>
</head>
<body>

<div class="container">
    <div class="controls">
        <button class="nav-btn" id="prev-btn">&lt; Prev</button>
        <span class="month-label" id="current-month-label">January 2026</span>
        <button class="nav-btn" id="next-btn">Next &gt;</button>
    </div>

    <div id="calendar-mount"></div>
</div>

<script>
    /** --- DOM Helper (Secure) --- */
    function el(tag, props = {}, ...children) {
        const element = document.createElement(tag);
        for (const [key, value] of Object.entries(props)) {
            if (key === 'className') element.className = value;
            else if (key === 'style' && typeof value === 'object') Object.assign(element.style, value);
            else if (key.startsWith('on') && typeof value === 'function') element.addEventListener(key.substring(2).toLowerCase(), value);
            else element.setAttribute(key, value);
        }
        children.forEach(child => {
            if (typeof child === 'string' || typeof child === 'number') element.textContent = child;
            else if (child instanceof Node) element.appendChild(child);
        });
        return element;
    }

    /** --- Color Utility --- */
    function getGroupColor(index) {
        const palette = ['#e67e22', '#27ae60', '#2980b9', '#8e44ad', '#c0392b', '#16a085', '#d35400', '#2c3e50'];
        return index < palette.length ? palette[index] : `hsl(${(index * 137.5) % 360}, 65%, 45%)`;
    }

    /**
     * --- Mock Data Generation ---
     * 実際にはロジックから出力されたJSONデータを使用します。
     * ここではデモ用に、特定の日付キー("YYYY-MM-DD")を持つデータを生成します。
     */
    function generateMockData(year, month) {
        const data = {};
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        for (let i = 1; i <= daysInMonth; i++) {
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
            
            // Randomly assign shifts to simulate real output
            const morningStaff = [];
            const afternoonStaff = [];
            
            if (Math.random() > 0.2) { // 80% chance of having morning shift
                morningStaff.push({ name: "Sato", groupIdx: 0 });
                if (Math.random() > 0.5) morningStaff.push({ name: "Suzuki", groupIdx: 1 });
            }
            if (Math.random() > 0.2) { // 80% chance of having afternoon shift
                afternoonStaff.push({ name: "Tanaka", groupIdx: 0 });
                if (Math.random() > 0.3) afternoonStaff.push({ name: "Yamada", groupIdx: 1 });
                if (Math.random() > 0.7) afternoonStaff.push({ name: "Kato", groupIdx: 2 });
            }

            data[dateStr] = {
                m: morningStaff,
                a: afternoonStaff
            };
        }
        return data;
    }

    // --- State ---
    const state = {
        year: 2026,
        month: 0, // 0 = Jan
        scheduleData: {} // Key: "YYYY-MM-DD", Value: { m: [], a: [] }
    };

    // Initialize Mock Data (Load 3 months for demo)
    Object.assign(state.scheduleData, generateMockData(2025, 11)); // Dec 2025
    Object.assign(state.scheduleData, generateMockData(2026, 0));  // Jan 2026
    Object.assign(state.scheduleData, generateMockData(2026, 1));  // Feb 2026

    /** --- Rendering Logic --- */
    
    function renderCalendar() {
        const mount = document.getElementById('calendar-mount');
        const label = document.getElementById('current-month-label');
        
        // Update Header
        const dt = new Date(state.year, state.month, 1);
        label.textContent = dt.toLocaleDateString('en-US', { year: 'numeric', month: 'long' }); // e.g., January 2026

        // Calendar Logic
        const year = state.year;
        const month = state.month; // 0-indexed
        
        const firstDayOfMonth = new Date(year, month, 1).getDay(); // 0(Sun) - 6(Sat)
        // Convert to Mon-Start (0:Mon ... 6:Sun)
        const startDayOffset = (firstDayOfMonth === 0 ? 6 : firstDayOfMonth - 1);
        
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        // Build Table
        const thead = el('thead', {}, 
            el('tr', {},
                el('th', {}, 'MON'), el('th', {}, 'TUE'), el('th', {}, 'WED'),
                el('th', {}, 'THU'), el('th', {}, 'FRI'), el('th', {}, 'SAT'),
                el('th', {}, 'SUN')
            )
        );

        const tbody = el('tbody');
        let tr = el('tr');
        let dayCount = 0;

        // Empty cells for previous month
        for (let i = 0; i < startDayOffset; i++) {
            tr.appendChild(el('td', { className: 'diff-month' }));
            dayCount++;
        }

        // Days of current month
        for (let d = 1; d <= daysInMonth; d++) {
            if (dayCount % 7 === 0 && dayCount !== 0) {
                tbody.appendChild(tr);
                tr = el('tr');
            }

            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
            const dayData = state.scheduleData[dateStr] || { m: [], a: [] };

            // Cell Content
            const cellContent = [];
            
            // 1. Date Label
            cellContent.push(el('span', { className: 'date-label' }, d));

            // 2. Morning Section
            if (dayData.m && dayData.m.length > 0) {
                const chips = dayData.m.map(staff => 
                    el('span', { 
                        className: 'staff-chip',
                        style: { borderLeftColor: getGroupColor(staff.groupIdx) },
                        title: staff.name
                    }, staff.name)
                );
                cellContent.push(el('div', { className: 'shift-section' },
                    el('div', { className: 'shift-label' }, 'AM'),
                    ...chips
                ));
            }

            // 3. Afternoon Section
            if (dayData.a && dayData.a.length > 0) {
                const chips = dayData.a.map(staff => 
                    el('span', { 
                        className: 'staff-chip',
                        style: { borderLeftColor: getGroupColor(staff.groupIdx) },
                        title: staff.name
                    }, staff.name)
                );
                cellContent.push(el('div', { className: 'shift-section' },
                    el('div', { className: 'shift-label' }, 'PM'),
                    ...chips
                ));
            }

            const td = el('td', { className: 'day-cell' }, ...cellContent);
            
            // Highlight today (optional)
            const today = new Date();
            if (today.getFullYear() === year && today.getMonth() === month && today.getDate() === d) {
                td.classList.add('today');
            }

            tr.appendChild(td);
            dayCount++;
        }

        // Empty cells for next month to fill the row
        while (dayCount % 7 !== 0) {
            tr.appendChild(el('td', { className: 'diff-month' }));
            dayCount++;
        }
        tbody.appendChild(tr);

        const table = el('table', { className: 'calendar-table' }, thead, tbody);
        mount.replaceChildren(table);
    }

    // --- Event Handlers ---
    document.getElementById('prev-btn').onclick = () => {
        state.month--;
        if (state.month < 0) {
            state.month = 11;
            state.year--;
        }
        renderCalendar();
    };

    document.getElementById('next-btn').onclick = () => {
        state.month++;
        if (state.month > 11) {
            state.month = 0;
            state.year++;
        }
        renderCalendar();
    };

    // Init
    renderCalendar();

</script>
</body>
</html>
